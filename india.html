<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Mobile Friendly India Map with Undo & State Labels</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #111;
      font-family: Arial, sans-serif;
      user-select: none;
      position: relative;
    }
    #controls {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      gap: 15px;
      align-items: center;
      user-select: none;
      background: transparent;
      padding: 0;
    }
    #magicBox {
      background: rgba(0, 128, 255, 0.9);
      color: white;
      font-size: 1.6rem;
      padding: 10px 20px;
      border-radius: 12px;
      cursor: pointer;
      min-width: 220px;
      text-align: center;
      box-shadow: 0 0 12px rgba(0,128,255,0.8);
      font-weight: 600;
      transition: background-color 0.3s ease;
      user-select: none;
      white-space: nowrap;
    }
    #magicBox:hover {
      background: rgba(0, 150, 255, 1);
    }
    #undoBtn {
      background: transparent;
      border: none;
      cursor: pointer;
      width: 44px;
      height: 44px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      box-shadow: 0 0 0 2px #1e90ff;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #undoBtn:hover {
      background: rgba(30, 144, 255, 0.15);
    }
    #undoBtn svg {
      width: 24px;
      height: 24px;
      fill: #1e90ff;
      pointer-events: none;
      user-select: none;
    }
    #scrollContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: calc(100vh - 75px);
      overflow-x: auto;
      overflow-y: hidden;
      background: #111;
      white-space: nowrap;
      box-sizing: border-box;
      padding-top: 65px;
    }
    #imageWrapper {
      position: relative;
      height: 100%;
      display: inline-block;
    }
    #bgImage {
      height: 100%;
      width: auto;
      display: block;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      pointer-events: none;
    }
    .district-label {
      position: absolute;
      color: black;
      padding: 4px 10px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.85rem;
      white-space: nowrap;
      pointer-events: none;
      user-select: none;
      background: transparent;
      border: 1.8px solid #1e90ff;
      text-shadow: none;
      transform: translate(-50%, -100%);
      z-index: 1001;
    }
    .district-label::after {
      content: '';
      position: absolute;
      bottom: -6px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 10px;
      background-color: #1e90ff;
      border-radius: 50%;
      box-shadow: 0 0 3px rgba(30,144,255,0.7);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="controls">
    <div id="magicBox" title="Click to select state">Loading...</div>
    <button id="undoBtn" title="Undo last placed state" aria-label="Undo">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6 0 1.18-.41 2.26-1.09 3.11l1.46 1.46C19.69 16.16 20 14.62 20 13c0-4.42-3.58-8-8-8z"/>
        <path d="M6 12H4v2h2v-2zm2 5h2v-2H8v2z"/>
      </svg>
    </button>
  </div>
  <div id="scrollContainer">
    <div id="imageWrapper">
      <img
        src="https://iili.io/KGH23WN.md.jpg"
        alt="India Map"
        id="bgImage"
        draggable="false"
      />
    </div>
  </div>

  <script>
    const states = [
      "Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand",
      "Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab",
      "Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal","Delhi","Jammu and Kashmir",
      "Ladakh"
    ];

    const magicBox = document.getElementById("magicBox");
    const undoBtn = document.getElementById("undoBtn");
    const scrollContainer = document.getElementById("scrollContainer");
    const imageWrapper = document.getElementById("imageWrapper");
    const bgImage = document.getElementById("bgImage");

    let selectedState = null;
    let placedStates = new Set();
    let placedLabels = [];

    function setRandomState() {
      let availableStates = states.filter(s => !placedStates.has(s));
      if (availableStates.length === 0) {
        magicBox.textContent = "All states placed";
        selectedState = null;
        return;
      }
      let randomIndex = Math.floor(Math.random() * availableStates.length);
      let state = availableStates[randomIndex];
      magicBox.textContent = state;
      selectedState = null;
    }

    setRandomState();

    magicBox.addEventListener("click", () => {
      if (selectedState === null && magicBox.textContent !== "All states placed") {
        selectedState = magicBox.textContent;
        magicBox.style.background = "rgba(0, 200, 100, 0.95)";
        setTimeout(() => {
          magicBox.style.background = "rgba(0, 128, 255, 0.9)";
        }, 2000);
      }
    });

    scrollContainer.addEventListener("click", (e) => {
      if (!selectedState) {
        alert("Please tap the magic box to select the state before placing.");
        return;
      }
      const imgRect = bgImage.getBoundingClientRect();
      const wrapperRect = imageWrapper.getBoundingClientRect();
      if (
        e.clientX < imgRect.left || e.clientX > imgRect.right ||
        e.clientY < imgRect.top || e.clientY > imgRect.bottom
      ) {
        alert("Please tap inside the image area.");
        return;
      }
      const x = e.clientX - wrapperRect.left;
      const y = e.clientY - wrapperRect.top;
      const label = document.createElement("div");
      label.className = "district-label";
      label.textContent = selectedState;
      label.style.left = x + "px";
      label.style.top = y + "px";
      imageWrapper.appendChild(label);
      placedStates.add(selectedState);
      placedLabels.push({name: selectedState, element: label});
      selectedState = null;
      setRandomState();
    });

    undoBtn.addEventListener("click", () => {
      if (placedLabels.length === 0) {
        alert("No state label to undo.");
        return;
      }
      const last = placedLabels.pop();
      placedStates.delete(last.name);
      if (last.element && last.element.parentNode) {
        last.element.parentNode.removeChild(last.element);
      }
      if (selectedState === null) {
        magicBox.textContent = last.name;
      }
    });
  </script>
</body>
</html>
